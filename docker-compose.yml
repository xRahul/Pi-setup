services:


  tailscale:
    image: tailscale/tailscale:v1.84
    container_name: tailscale
    restart: unless-stopped
    environment:
      - TS_AUTHKEY=${TAILSCALE_AUTH_KEY}
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_USERSPACE=false
      - TS_HOSTNAME=win-docker-ts
      - TS_ROUTES=10.8.1.0/24
      - TS_EXTRA_ARGS=${TS_EXTRA_ARGS}
    volumes:
      - ${TAILSCALE_PATH}:/var/lib/tailscale
    devices:
      - /dev/net/tun:/dev/net/tun
    # sysctls:
    #   - net.ipv4.ip_forward=1
    #   - net.ipv6.conf.all.forwarding=1
    #   - net.ipv4.conf.all.src_valid_mark=1
    cap_add:
      - NET_ADMIN
      # - SYS_MODULE
    networks:
      wg-easy:
        ipv4_address: 10.8.1.48




  caddy:
    image: ghcr.io/caddybuilds/caddy-cloudflare:2.10
    container_name: caddy-cloudflare-web-server
    hostname: caddycloudflarewebserver
    user: 1000:1000 # should be owner of volumes
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    environment:
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - ${CADDY_SITE_PATH}:/srv
      - ${CADDY_DATA_PATH}:/data
      - ${CADDY_CONFIG_PATH}:/config
    networks:
      wg-easy:
        ipv4_address: 10.8.1.5



  web-test:
    image: crccheck/hello-world
    container_name: web-test
    restart: unless-stopped
    networks:
      wg-easy:
        ipv4_address: 10.8.1.49



# Booked 10.8.1.2 - 10.8.1.49

networks:
  wg-easy:
    ipam:
      config:
        - subnet: 10.8.1.0/24
